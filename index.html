<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© - Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ§Ø¨Ù„Øª Ø§Ù„Ù…Ø·ÙˆØ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --accent: #f59e0b;
            --bg-body: #f8fafc;
            --bg-card: #ffffff;
            --text-main: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --selected: #eff6ff;
            --selected-border: #3b82f6;
            --correct-bg: #dcfce7;
            --correct-border: #22c55e;
            --wrong-bg: #fee2e2;
            --wrong-border: #ef4444;
            --flagged: #fff7ed; /* Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø¤Ø¬Ù„ */
            --flagged-border: #f97316;
        }

        body.dark-mode {
            --primary: #60a5fa;
            --primary-dark: #3b82f6;
            --accent: #fbbf24;
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --text-main: #f1f5f9;
            --text-light: #94a3b8;
            --border: #334155;
            --selected: #172554;
            --selected-border: #60a5fa;
            --correct-bg: #064e3b;
            --correct-border: #34d399;
            --wrong-bg: #7f1d1d;
            --wrong-border: #f87171;
            --flagged: #431407;
            --flagged-border: #fb923c;
        }

        * { box-sizing: border-box; transition: all 0.2s ease; outline: none; }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            font-size: 16px; /* Base font size */
        }

        /* --- Progress Bar --- */
        .progress-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 4px;
            background: var(--border); z-index: 2000;
        }
        .progress-bar {
            height: 100%; background: var(--accent); width: 0%;
            transition: width 0.4s ease;
        }

        /* --- Sidebar --- */
        .sidebar {
            width: 280px;
            background: var(--bg-card);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 15px;
            z-index: 1000;
            box-shadow: 2px 0 15px rgba(0,0,0,0.05);
        }

        .brand {
            font-size: 1.2rem; font-weight: 800; color: var(--primary);
            margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
        }

        .nav-items { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 6px; padding-left: 5px; }

        .nav-btn {
            background: transparent; border: 1px solid transparent;
            padding: 10px; border-radius: 6px; text-align: right;
            cursor: pointer; font-weight: 600; color: var(--text-main);
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.95rem;
        }

        .nav-btn:hover { background: var(--bg-body); }
        .nav-btn.active { background: var(--selected); color: var(--primary); border-color: var(--selected-border); }
        .nav-btn .badge { background: var(--border); padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; color: var(--text-main); }
        
        /* Flag Indicator in Sidebar */
        .nav-btn.has-flags::after {
            content: ''; width: 8px; height: 8px; background: var(--accent);
            border-radius: 50%; display: inline-block; margin-right: 5px;
        }

        /* --- Font Controls --- */
        .font-controls {
            display: flex; justify-content: center; gap: 10px; margin-bottom: 15px;
            background: var(--bg-body); padding: 8px; border-radius: 8px;
        }
        .font-btn {
            background: var(--bg-card); border: 1px solid var(--border);
            width: 35px; height: 35px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-weight: bold; color: var(--text-main);
        }
        .font-btn:hover { border-color: var(--primary); color: var(--primary); }

        /* --- Main Content --- */
        .main-content {
            flex: 1; overflow-y: auto; padding: 20px 40px; position: relative;
            scroll-behavior: smooth; margin-top: 4px; /* for progress bar */
        }

        .section-header { 
            margin: 30px 0 20px; padding-bottom: 10px; border-bottom: 2px solid var(--accent);
            display: flex; align-items: center; justify-content: space-between;
        }
        .section-title { font-size: 1.5rem; font-weight: 800; color: var(--primary); margin: 0; }

        /* --- Passages --- */
        .passage-card {
            background: var(--bg-card); border-radius: 10px; padding: 30px;
            margin-bottom: 30px; border-right: 4px solid var(--primary);
            line-height: 2.2; font-size: 1.1em; text-align: justify;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03); color: var(--text-main);
        }
        .passage-card strong { color: var(--accent); }

        /* --- Questions --- */
        .q-card {
            background: var(--bg-card); border-radius: 12px; padding: 25px;
            margin-bottom: 25px; border: 1px solid var(--border);
            position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }

        /* Flag/Bookmark Button */
        .flag-btn {
            position: absolute; top: 20px; left: 20px;
            background: transparent; border: 1px solid var(--border);
            color: var(--text-light); width: 35px; height: 35px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 5; font-size: 1.2rem;
        }
        .flag-btn.active { background: var(--accent); color: white; border-color: var(--accent); }

        .q-header {
            display: flex; gap: 15px; margin-bottom: 15px; align-items: center;
            color: var(--text-light); font-size: 0.9rem;
        }
        .q-num { background: var(--bg-body); padding: 4px 10px; border-radius: 6px; font-weight: bold; color: var(--primary); }

        .q-text { font-size: 1.2rem; font-weight: 700; margin-bottom: 20px; line-height: 1.6; padding-left: 40px; }

        .options-grid { display: grid; gap: 10px; }
        
        .option {
            background: var(--bg-body); padding: 12px 18px; border-radius: 8px;
            cursor: pointer; border: 2px solid transparent; display: flex;
            align-items: center; gap: 12px; font-weight: 500; position: relative;
            transition: transform 0.1s;
        }

        .option:hover { border-color: var(--primary-light); background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .option:active { transform: scale(0.995); }
        
        .option.selected {
            background: var(--selected); border-color: var(--selected-border);
            font-weight: 700;
        }

        .circle {
            width: 20px; height: 20px; border-radius: 50%; border: 2px solid #cbd5e1;
            flex-shrink: 0; display: flex; justify-content: center; align-items: center;
        }
        .option.selected .circle { border-color: var(--primary); background: var(--primary); }
        .option.selected .circle::after { content: 'âœ“'; color: white; font-size: 12px; }

        /* Review Mode Styles */
        body.review-mode .option { cursor: default; }
        body.review-mode .option.is-correct {
            background-color: var(--correct-bg) !important;
            border-color: var(--correct-border) !important;
            color: #065f46 !important;
        }
        body.review-mode .option.is-wrong {
            background-color: var(--wrong-bg) !important;
            border-color: var(--wrong-border) !important;
            color: #991b1b !important;
        }

        /* Explanation Box (Hidden by default) */
        .explanation-box {
            display: none; margin-top: 15px; padding: 15px;
            background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px;
            color: #166534; font-size: 0.95rem;
        }
        body.review-mode .explanation-box { display: block; animation: fadeIn 0.5s; }

        /* --- Footer Tools --- */
        .tools-area { margin-top: auto; padding-top: 15px; border-top: 1px solid var(--border); }
        .timer-box {
            background: var(--text-main); color: var(--bg-body); padding: 10px;
            border-radius: 8px; text-align: center; font-weight: 800;
            font-size: 1.3rem; margin-bottom: 10px; letter-spacing: 2px;
        }

        .action-btns { display: flex; gap: 8px; }
        .btn {
            flex: 1; padding: 10px; border: none; border-radius: 6px;
            cursor: pointer; font-weight: bold; font-family: inherit; font-size: 0.9rem;
        }
        .btn-theme { background: var(--bg-body); color: var(--text-main); border: 1px solid var(--border); }
        .btn-submit { background: var(--primary); color: white; }
        .btn-submit:hover { background: var(--primary-dark); }

        /* --- Modal --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 2000; display: none;
            justify-content: center; align-items: center; backdrop-filter: blur(4px);
        }
        .modal-content {
            background: var(--bg-card); width: 95%; max-width: 500px;
            padding: 30px; border-radius: 16px; text-align: center;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Mobile */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            .sidebar {
                width: 100%; flex-direction: row; align-items: center; padding: 10px;
                order: -1; border-bottom: 1px solid var(--border); border-left: none;
                height: auto;
            }
            .brand span:last-child { display: none; }
            .tools-area, .font-controls { display: none; } /* Hide tools on mobile header to save space */
            .nav-items { flex-direction: row; overflow-x: auto; padding-bottom: 5px; }
            .nav-btn { white-space: nowrap; padding: 6px 12px; font-size: 0.8rem; }
            .main-content { padding: 15px; padding-bottom: 80px; }
            .q-text { padding-left: 0; padding-right: 35px; /* space for flag */ }
            
            /* Mobile Sticky Footer for Submit/Timer if needed, kept simple here */
        }
    </style>
</head>
<body>

<div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>

<aside class="sidebar">
    <div class="brand">
        <span>ğŸ“ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span>
        <span style="font-size:0.8rem; color:var(--text-light);">v2.0</span>
    </div>
    
    <div class="font-controls">
        <button class="font-btn" onclick="changeFontSize(-1)" title="ØªØµØºÙŠØ± Ø§Ù„Ø®Ø·">A-</button>
        <button class="font-btn" onclick="resetFontSize()" title="Ø§Ø³ØªØ¹Ø§Ø¯Ø©">A</button>
        <button class="font-btn" onclick="changeFontSize(1)" title="ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø·">A+</button>
    </div>

    <div class="nav-items" id="navContainer">
        </div>

    <div class="tools-area">
        <div class="timer-box" id="timer">03:00:00</div>
        <div class="action-btns">
            <button class="btn btn-theme" onclick="toggleTheme()">ğŸŒ™</button>
            <button class="btn btn-submit" id="submitBtnMain" onclick="submitExam()">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
        </div>
    </div>
</aside>

<main class="main-content" id="renderArea">
    </main>

<div class="modal" id="resultModal">
    <div class="modal-content">
        <div style="font-size:3rem; margin-bottom:10px;">ğŸ“Š</div>
        <h2 style="margin:0; color:var(--primary);">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</h2>
        <div style="font-size:4rem; font-weight:900; color:var(--text-main); margin:10px 0;">
            <span id="finalScore">0</span><span style="font-size:1.5rem; color:var(--text-light);">/80</span>
        </div>
        
        <div style="background:var(--bg-body); padding:15px; border-radius:8px; text-align:right; margin:20px 0; font-size:0.95rem; border-right:4px solid var(--accent);">
            <div id="feedbackText">...</div>
        </div>

        <div style="display:flex; flex-direction:column; gap:10px;">
            <button class="btn btn-submit" onclick="startReviewMode()">ğŸ” Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©</button>
            <button class="btn btn-theme" onclick="location.reload()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
        </div>
    </div>
</div>

<script>
    // --- 1. Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù†ÙØ³ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© - Ù„Ù… ÙŠØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø­ØªÙˆÙ‰) ---
    const sectionsConfig = [
        { id: 'Read1', title: 'Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©', count: 6 },
        { id: 'Read2', title: 'Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø£Ø¯Ø¨ÙŠØ©', count: 6 },
        { id: 'Poetry', title: 'Ø§Ù„Ù†ØµÙˆØµ', count: 8 },
        { id: 'Lit', title: 'Ø§Ù„Ø£Ø¯Ø¨', count: 5 },
        { id: 'Grammar', title: 'Ø§Ù„Ù†Ø­Ùˆ', count: 35 },
        { id: 'Expr', title: 'Ø§Ù„ØªØ¹Ø¨ÙŠØ±', count: 20 }
    ];

    // (ØªÙ… Ø§Ø®ØªØµØ§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§ Ù„Ù„Ø¹Ø±Ø¶ØŒ Ø§Ù†Ø³Ø® Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø§Ù„Ù€ 80 Ø³Ø¤Ø§Ù„ ÙˆØ¶Ø¹Ù‡Ø§ Ù‡Ù†Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØºÙŠØ± examData)
    // Ø³Ø£Ø¶Ø¹ Ø¹ÙŠÙ†Ø© Ù„Ù„ØªØ¬Ø±Ø¨Ø©ØŒ *Ø¹Ù„ÙŠÙƒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ Ø¨ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ù…Ù„ÙÙƒ Ø§Ù„Ø£ØµÙ„ÙŠ*
    const examData = [
        // ... (Ø¶Ø¹ Ù‡Ù†Ø§ Ø§Ù„Ù€ array Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ù…Ù„ÙÙƒ Ø§Ù„Ø£ØµÙ„ÙŠ Ø§Ù„Ù…Ø³Ù…Ø§Ø© examData) ...
        // Ù…Ø«Ø§Ù„ Ù„Ù„ØªÙˆØ¶ÙŠØ­:
        {
            type: 'passage', section: 'Read1',
            content: `<strong>Ø£ÙˆÙ„Ø§Ù‹: Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…ØªØ­Ø±Ø±Ø©</strong><br>Ù‡Ø°Ø§ Ù†Øµ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ù‚ÙŠØ§Ø³ Ø¹Ù„ÙŠÙ‡... (ÙŠØ±Ø¬Ù‰ Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ Ù‡Ù†Ø§)`
        },
        { section: 'Read1', q: 'Ø³Ø¤Ø§Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ Ø±Ù‚Ù… 1ØŸ', options: ['Ø£', 'Ø¨', 'Ø¬', 'Ø¯'], a: 1 },
         // ... Ø§Ù„Ø®
    ];

    // --- State ---
    let userAnswers = new Array(80).fill(null); // ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø±Ù‚Ù… Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ÙØ¹Ù„ÙŠ
    let flaggedQuestions = new Set();
    let currentFontSize = 16;
    let timerInterval;
    let isSubmitted = false;

    // --- Initialization ---
    function init() {
        // ÙÙŠ Ø­Ø§Ù„ Ù†Ø³Ø®Øª Ø§Ù„ÙƒÙˆØ¯ØŒ ØªØ£ÙƒØ¯ Ø£Ù† examData Ù…Ù…ØªÙ„Ø¦Ø©. Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙØ§Ø±ØºØ© Ø³ÙŠØ¹Ø·ÙŠ Ø®Ø·Ø£.
        // Ø³Ø£Ù‚ÙˆÙ… Ø¨Ù…Ù„Ø¡ userAnswers Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·ÙˆÙ„ examData Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        // userAnswers = new Array(examData.length).fill(null); 
        
        renderNav();
        renderQuestions();
        startTimer();
        updateProgressBar();
    }

    // --- Rendering ---
    function renderNav() {
        const nav = document.getElementById('navContainer');
        nav.innerHTML = sectionsConfig.map((sec, idx) => `
            <div class="nav-btn ${idx===0 ? 'active' : ''}" id="nav-${sec.id}" onclick="scrollToSection('${sec.id}')">
                <span>${sec.title}</span>
                <span class="badge">${sec.count}</span>
            </div>
        `).join('');
    }

    function renderQuestions() {
        // Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù„ÙˆÙƒ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØŒ 
        // Ø³Ø£ÙØªØ±Ø¶ Ø£Ù†Ùƒ Ø³ØªÙ‚ÙˆÙ… Ø¨Ø¯Ù…Ø¬Ù‡Ø§. Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ§Ù„ÙŠ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ÙˆØ¬ÙˆØ¯ examData
        
        // *Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©:* ÙŠØ¬Ø¨ Ù†Ø³Ø® Ù…ØµÙÙˆÙØ© examData ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ù…Ù„ÙÙƒ Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆÙˆØ¶Ø¹Ù‡Ø§ Ù…ÙƒØ§Ù† Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø£Ø¹Ù„Ø§Ù‡.
        
        // Ø¥Ø°Ø§ Ù„Ù… ØªÙ‚Ù… Ø¨Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø³Ø£Ù‚ÙˆÙ… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© ÙÙ‚Ø· Ù„ÙŠØ¹Ù…Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ø¹Ø±Ø¶
        if(typeof examData === 'undefined' || examData.length < 2) {
             // Ù‡Ø°Ø§ ÙÙ‚Ø· Ù„ÙƒÙŠ ÙŠØ¹Ù…Ù„ Ø§Ù„Ù…Ø«Ø§Ù„ØŒ Ø§Ø­Ø°ÙÙ‡ Ø¹Ù†Ø¯ ÙˆØ¶Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ
             window.examData = [
                { type: 'passage', section: 'Read1', content: 'Ù†Øµ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…ØªØ­Ø±Ø±Ø©...' },
                { section: 'Read1', q: 'Ø³Ø¤Ø§Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ 1', options: ['1','2','3','4'], a: 0 },
                { section: 'Read1', q: 'Ø³Ø¤Ø§Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ 2', options: ['1','2','3','4'], a: 1 }
             ];
             userAnswers = new Array(examData.length).fill(null);
        }

        const container = document.getElementById('renderArea');
        let html = '';
        let qCounter = 0;

        sectionsConfig.forEach(sec => {
            const items = examData.filter(d => d.section === sec.id);
            if(items.length === 0) return;

            html += `<div id="${sec.id}" class="section-header"><h2 class="section-title">${sec.title}</h2></div>`;
            
            items.forEach(item => {
                if(item.type === 'passage') {
                    html += `<div class="passage-card">${item.content}</div>`;
                } else {
                    let globalIdx = qCounter; // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„ØµØ­ÙŠØ­
                    
                    let optionsHTML = item.options.map((opt, i) => `
                        <div class="option" onclick="selectOption(${globalIdx}, ${i}, this)" id="opt-${globalIdx}-${i}">
                            <div class="circle"></div>
                            <span>${opt}</span>
                        </div>
                    `).join('');

                    html += `
                        <div class="q-card" id="q-card-${globalIdx}">
                            <button class="flag-btn" onclick="toggleFlag(${globalIdx}, this)" title="ØªØ£Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©">ğŸ”–</button>
                            <div class="q-header">
                                <span class="q-num">Ø³Ø¤Ø§Ù„ ${globalIdx + 1}</span>
                                <span>Ø¯Ø±Ø¬Ø© ÙˆØ§Ø­Ø¯Ø©</span>
                            </div>
                            <div class="q-text">${item.q}</div>
                            <div class="options-grid">${optionsHTML}</div>
                            <div class="explanation-box">
                                <strong>ğŸ’¡ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ: ${item.options[item.a]}</strong><br>
                                Ø§Ù„ØªÙØ³ÙŠØ±: Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡ÙŠ Ø§Ù„Ø£Ø¯Ù‚ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø³ÙŠØ§Ù‚ Ø§Ù„Ø¬Ù…Ù„Ø© ÙˆØ§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù†Ø­ÙˆÙŠØ©...
                            </div>
                        </div>
                    `;
                    qCounter++;
                }
            });
        });
        container.innerHTML = html;
        
        // Resize check
        userAnswers = new Array(qCounter).fill(null);
    }

    // --- Logic ---
    function selectOption(qIdx, optIdx, element) {
        if (isSubmitted) return;
        userAnswers[qIdx] = optIdx;
        
        // UI
        const parent = element.parentElement;
        parent.querySelectorAll('.option').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');

        updateProgressBar();
    }

    function toggleFlag(qIdx, btn) {
        if(flaggedQuestions.has(qIdx)) {
            flaggedQuestions.delete(qIdx);
            btn.classList.remove('active');
        } else {
            flaggedQuestions.add(qIdx);
            btn.classList.add('active');
        }
        // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ù„ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ù‚Ø³Ù… ÙÙŠ Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠÙ‡ Ø£Ø³Ø¦Ù„Ø© Ù…Ø¤Ø¬Ù„Ø©
    }

    function updateProgressBar() {
        const total = userAnswers.length;
        const answered = userAnswers.filter(a => a !== null).length;
        const pct = (answered / total) * 100;
        document.getElementById('progressBar').style.width = `${pct}%`;
    }

    function changeFontSize(delta) {
        currentFontSize += delta;
        if(currentFontSize < 12) currentFontSize = 12;
        if(currentFontSize > 24) currentFontSize = 24;
        document.body.style.fontSize = currentFontSize + 'px';
    }
    
    function resetFontSize() {
        currentFontSize = 16;
        document.body.style.fontSize = '16px';
    }

    function scrollToSection(id) {
        document.getElementById(id).scrollIntoView({ behavior: 'smooth', block: 'start' });
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('nav-'+id).classList.add('active');
    }

    function startTimer() {
        let duration = 3 * 3600; 
        const display = document.getElementById('timer');
        timerInterval = setInterval(() => {
            duration--;
            let h = Math.floor(duration / 3600);
            let m = Math.floor((duration % 3600) / 60);
            let s = duration % 60;
            display.innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            if(duration <= 0) submitExam();
        }, 1000);
    }

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
    }

    // --- Submission & Review ---
    function submitExam() {
        if (isSubmitted) return;
        const answered = userAnswers.filter(a => a !== null).length;
        if(answered < userAnswers.length) {
            if(!confirm(`Ø£Ø¬Ø¨Øª Ø¹Ù„Ù‰ ${answered} Ù…Ù† ${userAnswers.length}. Ù‡Ù„ ØªØ³Ù„Ù… Ø§Ù„ÙˆØ±Ù‚Ø©ØŸ`)) return;
        }

        isSubmitted = true;
        clearInterval(timerInterval);
        document.getElementById('submitBtnMain').innerText = "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…";
        document.getElementById('submitBtnMain').disabled = true;

        // Calculate
        let score = 0;
        let qIdx = 0;
        
        // Ù†Ø­ØªØ§Ø¬ Ù‡Ù†Ø§ Ù„Ù„Ø¯ÙˆØ±Ø§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø§ØªØ§ ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø³Ø¦Ù„Ø© ÙÙ‚Ø· (ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù‚Ø·Ø¹)
        examData.forEach(item => {
            if(item.type !== 'passage') {
                if(userAnswers[qIdx] === item.a) score++;
                qIdx++;
            }
        });

        const pct = Math.round((score / qIdx) * 100);
        
        let msg = pct >= 85 ? "Ù…Ù…ØªØ§Ø²! ğŸŒŸ" : (pct >= 50 ? "Ø¬ÙŠØ¯ØŒ Ø­Ø§ÙˆÙ„ ØªØ­Ø³ÙŠÙ† Ù…Ø³ØªÙˆØ§Ùƒ ğŸ‘" : "ØªØ­ØªØ§Ø¬ Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© âš ï¸");
        
        document.getElementById('finalScore').innerText = score;
        document.getElementById('feedbackText').innerHTML = `<strong>Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…:</strong> ${msg}<br>Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­: ${pct}%`;
        document.getElementById('resultModal').style.display = 'flex';
    }

    function startReviewMode() {
        document.getElementById('resultModal').style.display = 'none';
        document.body.classList.add('review-mode');
        
        let qGlobalIdx = 0;
        examData.forEach(item => {
            if(item.type !== 'passage') {
                const card = document.getElementById(`q-card-${qGlobalIdx}`);
                const opts = card.querySelectorAll('.option');
                
                // Colorize
                opts[item.a].classList.add('is-correct'); // Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø®Ø¶Ø±Ø§Ø¡
                
                const userChoice = userAnswers[qGlobalIdx];
                if(userChoice !== null && userChoice !== item.a) {
                    opts[userChoice].classList.add('is-wrong'); // Ø®Ø·Ø£ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ø­Ù…Ø±
                }

                qGlobalIdx++;
            }
        });

        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Start
    init();

</script>
</body>
</html>
